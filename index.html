<!DOCTYPE html>
<html>
<head>
Â  <meta charset="utf-8" />
Â  <title>ShowCase</title>
Â  <style>
Â  Â  html, body { width: 100%; height: 100%; margin: 0; overflow: hidden; }
Â  Â  #renderCanvas { width: 100%; height: 100%; touch-action: none; }
Â  </style>

Â  Â  <script src="https://cdn.babylonjs.com/babylon.js"></script>
Â  <script src="https://cdn.babylonjs.com/loaders/babylon.glTF2FileLoader.min.js"></script>
Â  <script src="https://cdn.babylonjs.com/ammo.js"></script>

Â  Â  <script src="js/physics.js"></script>


</head>
<body>
Â  <canvas id="renderCanvas"></canvas>

Â  <script>
Â  Â  // ================================
Â  Â  // Inisialisasi Engine & Canvas
Â  Â  // ================================
Â  Â  const canvas = document.getElementById("renderCanvas");
Â  Â  const engine = new BABYLON.Engine(canvas, true);

Â  Â  // ================================
Â  Â  // Fungsi utama: Membuat Scene
Â  Â  // ================================
Â  Â  const createScene = async function () {
Â  Â  Â  const scene = new BABYLON.Scene(engine);
Â  Â  Â  scene.clearColor = new BABYLON.Color3(0.9, 0.9, 0.95);

Â  Â  Â  // Aktifkan sistem fisika dari file physics.js
Â  Â  Â  await enablePhysics(scene);

Â  Â  Â  // ================================
Â  Â  Â  // Buat ground (lantai dunia)
Â  Â  Â  // ================================
Â  Â  Â  const ground = BABYLON.MeshBuilder.CreateGround("ground", { width: 100, height: 100 }, scene);
Â  Â  Â  ground.checkCollisions = true;
Â  Â  Â  ground.position.y = 0;

Â  Â  Â  // Tambahkan Physics Impostor agar terpengaruh fisika
Â  Â  Â  ground.physicsImpostor = new BABYLON.PhysicsImpostor(
Â  Â  Â  Â  ground,
Â  Â  Â  Â  BABYLON.PhysicsImpostor.BoxImpostor,
Â  Â  Â  Â  { mass: 0, restitution: 0.9 },
Â  Â  Â  Â  scene
Â  Â  Â  );

Â  Â  Â  // ================================
Â  Â  Â  // Cahaya dan Arah
Â  Â  Â  // ================================
Â  Â  Â  const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), scene);
Â  Â  Â  light.intensity = 0.7;

Â  Â  Â  const dirLight = new BABYLON.DirectionalLight("dirLight", new BABYLON.Vector3(-1, -2, -1), scene);
Â  Â  Â  dirLight.intensity = 1;

Â  Â  Â  // ================================
// Kamera sebagai "Player" (POV manusia)
// ================================
const camera = new BABYLON.UniversalCamera("camera", new BABYLON.Vector3(-15, 4, 0), scene);
Â  Â  camera.attachControl(canvas, true);
Â  Â  camera.applyGravity = true;
Â  Â  camera.ellipsoid = new BABYLON.Vector3(0.5, 2, 0.5);
Â  Â  camera.checkCollisions = true;
Â  Â  camera.speed = 0.2;
Â  Â  camera.keysUp.push(87); camera.keysDown.push(83); camera.keysLeft.push(65); camera.keysRight.push(68);Â 

Â  Â  let xr = null;

Â  Â  Â  // ================================
// Tambahkan Model + Collision
// ================================
BABYLON.SceneLoader.Append("assets/", "ruang_periksa.glb", scene, function () {
Â  console.log("âœ… Model dimuat!");

Â Â 
Â  // Tunggu sampai model selesai dimuat sepenuhnya
Â  scene.executeWhenReady(() => {
Â  Â  // Loop semua mesh di scene
Â  Â  scene.meshes.forEach(mesh => {
Â  Â  Â  // Abaikan ground, kamera, dan helper mesh
Â  Â  Â  if (mesh.name !== "ground" && mesh.name !== "playerCam" && mesh.name !== "__root__") {
Â  Â  Â  Â  mesh.checkCollisions = true; // Aktifkan collision
Â  Â  Â  Â  mesh.isPickable = true;Â  Â  Â  // Boleh diklik (optional)
Â  Â  Â  }
Â  Â  });
Â  Â  console.log("ðŸ§± Collision diaktifkan untuk semua mesh model ruang_periksa.glb");
Â  });
});


Â  Â  Â  // ================================
Â  Â  Â  // Aktifkan VR / XR Mode
Â  Â  Â  // ================================
try {
Â  Â  Â  Â  xr = await scene.createDefaultXRExperienceAsync({
Â  Â  Â  Â  Â  floorMeshes: [ground],
Â  Â  Â  Â  Â  disableTeleportation: true,
Â  Â  Â  Â  Â  cameraOptions:{
Â  Â  Â  Â  Â  Â  checkCollisions: true,
Â  Â  Â  Â  Â  Â  applyGravity: true,
Â  Â  Â  Â  Â  Â  // ELLIPSOID Y diatur ke 2 (tinggi badan)
Â  Â  Â  Â  Â  Â  ellipsoid: new BABYLON.Vector3(0.5, 2, 0.5)
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â  console.log("âœ… WebXR aktif");
Â  Â  Â  Â  
Â  Â  Â  Â  const xrCamera = xr.baseExperience.camera;
Â  Â  Â  Â  xrCamera.applyGravity = true;
Â  Â  Â  Â  xrCamera.checkCollisions = true;

Â  Â  Â  Â  const movementFeature = xr.baseExperience.featuresManager.enableFeature(
Â  Â  Â  Â  Â  BABYLON.WebXRFeatureName.MOVEMENT,
Â  Â  Â  Â  Â  "latest",
Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  xrInput: xr.input,
Â  Â  Â  Â  Â  Â  movementSpeed: 0.1,
Â  Â  Â  Â  Â  Â  rotationSpeed: 0.2,
Â  Â  Â  Â  Â  Â  movementControls: ["left-xr-standard-thumbstick"],
Â  Â  Â  Â  Â  Â  rotationControls: ["right-xr-standard-thumbstick"],
Â  Â  Â  Â  Â  Â  useThumbstickForMovement: true,
Â  Â  Â  Â  Â  Â  disableTeleportOnThumbstick: true,
Â  Â  Â  Â  Â  Â  checkCollisions: true,
Â  Â  Â  Â  Â  Â  applyGravity: true,
Â  Â  Â  Â  Â  Â  // ELLIPSOID Y diatur ke 2 (tinggi badan)
Â  Â  Â  Â  Â  Â  ellipsoid: new BABYLON.Vector3(0.5, 2, 0.5)
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  );
Â  Â  Â  
Â  Â  Â  
Â  Â  Â  } catch (e) {
Â  Â  Â  Â  console.warn("âš ï¸ WebXR tidak didukung, pakai mode biasa:", e);
Â  Â  Â  Â  scene.activeCamera = camera;
Â  Â  Â  Â  camera.applyGravity = true;
Â  Â  Â  Â  camera.checkCollisions = true;
Â  Â  Â  Â Â 
Â  Â  Â  }
      
      // === KODE UNTUK MEMAKSA KETINGGIAN AWAL (SOLUSI TERAKHIR) ===
      if (xr) {
          // Menggunakan ENTERING_XR untuk menyesuaikan posisi sebelum sistem XR menetapkannya
          xr.baseExperience.onStateChangedObservable.add((state) => {
              if (state === BABYLON.WebXRState.ENTERING_XR) {
                  const xrCamera = xr.baseExperience.camera;
                  // Atur posisi Y ke ketinggian awal yang diinginkan (4 meter)
                  xrCamera.position.y = 4; 
                  // Opsional: Atur posisi X dan Z agar sama dengan kamera non-VR
                  xrCamera.position.x = -15;
                  xrCamera.position.z = 0;
                  console.log("ðŸ”¥ Ketinggian kamera XR dipaksa menjadi 4m!");
              }
          });
      }
      
Â  Â  Â  console.log("WebXR state: ", xr.baseExperience.state);
Â  Â  Â  Â  console.log("Current Camera: ", scene.activeCamera);
Â  Â Â 

// ================================
// Muat GLB dengan physics
// ================================
BABYLON.SceneLoader.ImportMesh("", "assets/", "perban.glb", scene, function (meshes) {
Â  const rootMesh = meshes[0]; // ambil mesh utama
Â  rootMesh.position = new BABYLON.Vector3(-19, 2.5, 0.5);
Â  rootMesh.scaling = new BABYLON.Vector3(0.03, 0.03, 0.03);
Â });


BABYLON.SceneLoader.ImportMesh("", "assets/", "oximeter.glb", scene, function (meshes) {
Â  const rootMesh = meshes[0]; // ambil mesh utama
Â  rootMesh.position = new BABYLON.Vector3(-11, 2.6, 0.5);
Â  rootMesh.scaling = new BABYLON.Vector3(0.13, 0.13, 0.13);
});

BABYLON.SceneLoader.ImportMesh("", "assets/", "gunting medis.glb", scene, function (meshes) {
Â  const rootMesh = meshes[0]; // ambil mesh utama
Â  rootMesh.position = new BABYLON.Vector3(-11, 2.55, -3.5);
Â  rootMesh.scaling = new BABYLON.Vector3(0.035, 0.035, 0.035);
});

BABYLON.SceneLoader.ImportMesh("", "assets/", "reflex hammer.glb", scene, function (meshes) {
Â  const rootMesh = meshes[0]; // ambil mesh utama
Â  rootMesh.position = new BABYLON.Vector3(-11, 2.6, -7.5);
Â  rootMesh.scaling = new BABYLON.Vector3(3, 3, 3);
});

BABYLON.SceneLoader.ImportMesh("", "assets/", "stethoscope.glb", scene, function (meshes) {
Â  const rootMesh = meshes[0]; // ambil mesh utama
Â  rootMesh.position = new BABYLON.Vector3(-11, 2.6, -11.5);
Â  rootMesh.scaling = new BABYLON.Vector3(0.002, 0.002, 0.002);
});

BABYLON.SceneLoader.ImportMesh("", "assets/", "TIANG INFUS.glb", scene, function (meshes) {
Â  const rootMesh = meshes[0]; // ambil mesh utama
Â  rootMesh.position = new BABYLON.Vector3(-7.5, 0.2, -18.5);
Â  rootMesh.scaling = new BABYLON.Vector3(0.07, 0.07, 0.07);
});

BABYLON.SceneLoader.ImportMesh("", "assets/", "TIANG INFUS.glb", scene, function (meshes) {
Â  const rootMesh = meshes[0]; // ambil mesh utama
Â  rootMesh.position = new BABYLON.Vector3(-7.5, 0.2, -18.5);
Â  rootMesh.scaling = new BABYLON.Vector3(0.07, 0.07, 0.07);
});

BABYLON.SceneLoader.ImportMesh("", "assets/", "kasa.glb", scene, function (meshes) {
Â  const rootMesh = meshes[0]; // ambil mesh utama
Â  rootMesh.position = new BABYLON.Vector3(-19, 2.6, -3.5);
Â  rootMesh.scaling = new BABYLON.Vector3(5, 5, 5);
});

BABYLON.SceneLoader.ImportMesh("", "assets/", "suntik.glb", scene, function (meshes) {
Â  const rootMesh = meshes[0]; // ambil mesh utama
Â  rootMesh.position = new BABYLON.Vector3(-19, 2.3, -7.5);
Â  rootMesh.scaling = new BABYLON.Vector3(0.002, 0.002, 0.002);
});

BABYLON.SceneLoader.ImportMesh("", "assets/", "thermometer.glb", scene, function (meshes) {
Â  const rootMesh = meshes[0]; // ambil mesh utama
Â  rootMesh.position = new BABYLON.Vector3(-19, 2.6, -11.5);
Â  rootMesh.scaling = new BABYLON.Vector3(0.3, 0.3, 0.3);
Â  rootMesh.rotation = new BABYLON.Vector3(80, 160, 0);
});

BABYLON.SceneLoader.ImportMesh("", "assets/", "tensimeter.glb", scene, function (meshes) {
Â  const rootMesh = meshes[0]; // ambil mesh utama
Â  rootMesh.position = new BABYLON.Vector3(-19, 2.6, -15.5);
Â  rootMesh.scaling = new BABYLON.Vector3(0.3, 0.3, 0.3);
Â  rootMesh.rotation = new BABYLON.Vector3(80, 160, 0);
Â Â 
});

Â  Â  Â  return scene;
Â  Â  };

Â  Â Â 
Â  Â  // ================================
Â  Â  // Jalankan Scene
Â  Â  // ================================
Â  Â  createScene().then(scene => {
Â  Â  Â  engine.runRenderLoop(() => scene.render());
Â  Â  });

Â  Â  // Resize otomatis saat jendela berubah
Â  Â  window.addEventListener("resize", () => engine.resize());
Â  </script>
</body>
</html>
